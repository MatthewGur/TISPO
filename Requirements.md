**АДМ-001: Управление уровнями лояльности**
User story:  
Я, как администратор, хочу управлять уровнями лояльности, чтобы настраивать условия начисления баллов для покупателей в зависимости от их активности.  
  
Обоснование необходимости:  
Функционал управления уровнями лояльности позволяет администратору гибко настраивать программу лояльности, мотивируя покупателей совершать больше покупок и повышая их вовлеченность.  
  
Критерии приемки:  
  
Просмотр списка уровней лояльности:  

1. При нажатии на кнопку "Настроить данные приложения" бот выводит кнопки уровней и кнопки добавления и удаления уровней.

2. При нажатии на кнопку уровня отображается информация об уровне:

a) Название уровня.

b) Сумма покупок для достижения уровня.

c) Процент начисления баллов.

Добавление нового уровня лояльности:

1. На странице " Настроить данные приложения" доступна кнопка "Добавить уровень".

2. При нажатии на кнопку открывается форма с полями:

a) Сумма покупок для достижения уровня (обязательное поле, числовое поле).

b) Процент начисления баллов (обязательное поле, числовое поле).

3. После заполнения формы и нажатия кнопки "Сохранить" новый уровень добавляется в таблицу уровней.  
  
Редактирование уровня лояльности:

1. На странице уровня доступна кнопка "Редактировать".

2. При нажатии на кнопку открывается форма с предзаполненными данными уровня.

3. Администратор может изменить:

a) Сумму покупок для достижения уровня.

b) Процент начисления баллов.

4. После внесения изменений и нажатия кнопки "Сохранить" изменения применяются.  
  
Удаление уровня лояльности:

1. На странице уровня доступна кнопка "Удалить".

2. При нажатии на кнопку система запрашивает подтверждение удаления.

3. После подтверждения уровень удаляется из таблицы.

4. Все пользователи, находящиеся на удаленном уровне, переводятся на предыдущий уровень (если такой существует).

**АДМ-002: Управление пользователями**  
User story:  
Я, как администратор, хочу управлять пользователями программы лояльности, чтобы редактировать их данные, начислять или списывать баллы, блокировать или удалять пользователей, а также просматривать список всех участников программы.  
  
Обоснование необходимости:  
Функционал управления пользователями позволяет администратору контролировать участников программы лояльности, исправлять ошибки, начислять бонусы.  
  
Критерии приемки:  
  
Доступ к меню управления пользователями:

1. В чате администратора доступна кнопка "Управление пользователями".

2. При нажатии на кнопку открывается меню с вариантами действий:

a) Отредактировать данные пользователя.

b) Удалить пользователя.

c) Заблокировать/разблокировать пользователя.

d) Посмотреть список всех пользователей.

Редактирование данных пользователя:

1. При выборе пункта "Отредактировать данные" администратор вводит ID пользователя.

2. Система отображает информацию о пользователе:

a) ID телеграмм: [ID].

1. Username: [Username телеграмм].

2. Имя: [Имя].

3. Роль: [Роль в системе: администратор/пользователь].

4. Баллов лояльности: [число].

5. Потраченная сумма: [число].

6. Уровень лояльности: [число].

7. Процент начисления баллов: [процент].

b) 

3. Администратор может выполнить следующие действия:

a) Добавить покупку:

i. Вводит сумму покупки.

ii. Система автоматически пересчитывает баллы и обновляет данные пользователя.

b) Начислить баллы:

i. Вводит количество баллов для начисления.

ii. Система добавляет баллы к текущему балансу пользователя.

iii. Списать баллы:

1. Вводит количество баллов для списания.

2. Система проверяет, достаточно ли баллов у пользователя, и списывает их.  

Удаление пользователя:

1. При выборе пункта "Удалить пользователя" администратор вводит ID пользователя.

2. Система запрашивает подтверждение:  
Вы уверены, что хотите удалить пользователя с ID [ID]?

3. После подтверждения пользователь удаляется из базы данных.  
  
Блокировка/разблокировка пользователя:

1. При выборе пункта "Заблокировать/разблокировать пользователя" администратор вводит ID пользователя.

2. Система отображает текущий статус пользователя (заблокирован/активен).

3. Администратор может изменить статус:

a) Если пользователь активен, система блокирует его.

b) Если пользователь заблокирован, система разблокирует его.

4. После изменения статуса система отправляет уведомление:  
Статус пользователя с ID [ID] изменен на [новый статус].

Просмотр списка всех пользователей:  
При выборе пункта "Посмотреть список всех пользователей" система отображает таблицу:  
  
Список пользователей:

Всего найдено: [число]  
- Username: [Username] – ID: [ID].  
- Username: [Username] – ID: [ID].    
  
Обработка ошибок:

1. Если введенный ID пользователя не найден, система отправляет сообщение:  
Пользователь с ID [ID] не найден.

2. Если при редактировании данных, удалении или блокировке возникает ошибка, система отправляет сообщение:  
Произошла ошибка. Пожалуйста, попробуйте позже.

**ПОК-001: Регистрация в программе лояльности**  
User story:  
Я, как покупатель, хочу зарегистрироваться в программе лояльности через Telegram-бота, чтобы начать участвовать в программе лояльности.

Обоснование необходимости:  
Функционал регистрации и автоматического назначения уровня лояльности позволяет покупателю быстро присоединиться к программе, а система обеспечивает уникальность учетных записей на основе Telegram ID.  
  
Критерии приемки:  
  
Приветственное сообщение:

1. При первом входе в чат с ботом покупатель видит сообщение:  
Вас приветствует PhantomTrackBot!  
  
Здесь вы можете принять участие в программе лояльности PhantomTrack.  
За покупки вам будут начисляться баллы, которыми можно будет оплачивать последующие заказы.  
1 балл = 1 рубль.  
  
В боте вы сможете ознакомиться с условиями проведения программы лояльности и количеством баллов, которые имеются на вашем аккаунте.  
  
Для продолжения нажмите кнопку "Начать работу".  

2. Под сообщением доступна кнопка "Начать работу".  
  
Начало регистрации:

a) При нажатии на кнопку "Начать работу" бот проверяет, есть ли Telegram ID пользователя в базе данных бота.

b) Если пользователь уже зарегистрирован, бот отправляет сообщение:  
Вы уже зарегистрированы в программе лояльности PhantomTrack.

c) Если пользователь не зарегистрирован, бот сохраняет его Telegram ID в базу данных и назначает ему 1 уровень лояльности.  
  
Отображение информации после регистрации:

a) После успешной регистрации бот отправляет сообщение:  
  
”Добро пожаловать!  
  
Вам начислено [число] приветственных баллов.  
Сумма заказов: 0 руб.  
У вас 1 уровень лояльности.  
Коэффициент начисления баллов: [число]%.  
Ваш ID: [ID покупателя].  
Для достижения следующего уровня надо потратить [сколько нужно ещё потратить] руб.“

b) Данные в сообщении должны быть заполнены следующим образом:

i. Количество приветственных баллов берется из системных настроек (hardcode) программы лояльности (например, 30 баллов).

ii. Сумма заказов изначально равна 0 руб.

iii. Уровень лояльности по умолчанию — 1.

iv. Коэффициент начисления баллов для 1 уровня берется из настроек программы лояльности.

v. ID покупателя — это последние 4 цифры Telegram ID пользователя.

vi. Сумма для достижения следующего уровня берется из настроек программы лояльности.  

Завершение регистрации:

a) После отображения сообщения покупатель считается зарегистрированным в программе лояльности.

b) Бот отправляет дополнительное сообщение:  
  
Теперь вы участник программы лояльности PhantomTrack!  
Ваши баллы будут начисляться автоматически после каждой покупки.  
  
Обработка ошибок:

a) Если при регистрации возникает ошибка (например, проблема с подключением к базе данных), бот отправляет сообщение:  
Произошла ошибка при регистрации. Пожалуйста, попробуйте позже.

  

**ПОК-002: Просмотр профиля**  
User story:  
Я, как покупатель, хочу просматривать информацию о своем профиле в программе лояльности, чтобы знать текущий баланс баллов, уровень лояльности и другие данные, связанные с моим участием в программе.  
  
Обоснование необходимости:  
Функционал просмотра профиля позволяет покупателю отслеживать свои баллы в программе лояльности.  
  
Критерии приемки:  
  
Доступ к профилю:

1. В главном меню бота доступна кнопка "Профиль".

2. При нажатии на кнопку "Профиль" бот отображает информацию о покупателе:  
”Добро пожаловать, [Username]!  
  
Ваш баланс: [X] баллов.  
Сумма заказов: [X] руб.  
У вас [X] уровень лояльности.  
Коэффициент начисления баллов: [X]%.  
Ваш ID: [ID покупателя]. “

  
Формирование данных для отображения:

1. Данные в сообщении должны быть заполнены следующим образом:

a) Username: Берется из данных Telegram-аккаунта пользователя.

b) Баланс баллов: Текущее количество баллов на счету пользователя.

c) Сумма заказов: Общая сумма всех покупок пользователя.

d) Уровень лояльности: Текущий уровень пользователя.

e) Коэффициент начисления баллов: Процент начисления баллов, соответствующий текущему уровню лояльности.

f) ID покупателя: Уникальный идентификатор пользователя в системе.  
  
Обновление данных:

a) При каждом открытии профиля данные обновляются.

b) Если данные изменились (например, после покупки), бот отображает актуальную информацию только после обновления страницы профиля.  
  
Обработка ошибок:

a) Если данные не могут быть загружены (например, из-за проблем с подключением к базе данных), бот отправляет сообщение:  
  
Не удалось загрузить данные профиля. Пожалуйста, попробуйте позже.

**НЕФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ**

1. Производительность

Время отклика:  
Бот должен обрабатывать запросы пользователей и администраторов за время не более 2 секунд в 95% случаев.  
  
Масштабируемость:  
Система должна поддерживать до 1000 активных пользователей одновременно без существенного снижения производительности.  
  
Нагрузка:  
Бот должен выдерживать до 50 запросов в секунду без сбоев.  

2. Надежность

  
Доступность:  
Бот должен быть доступен 99,9% времени в течение года.  
  
Восстановление после сбоев:  
В случае сбоя бот должен восстановить работоспособность в течение 15 минут.  
  
Резервное копирование:  
Данные пользователей и администраторов должны резервироваться ежедневно.  

3. Безопасность

  
Защита данных:  
Все данные пользователей (Telegram ID, баланс баллов, история покупок) должны храниться в зашифрованном виде.  
  
Аутентификация:  
Доступ к функциям администратора должен быть защищен паролем.  
  
Защита от атак:  
Бот должен быть защищен от DDoS-атак.  

4. Поддержка и сопровождение  
Обновления:  
Система должна поддерживать возможность обновления функционала без остановки работы бота.  

5. Производительность базы данных  

Скорость запросов:  
Запросы к базе данных (например, получение баланса баллов или уровня лояльности) должны выполняться за время не более 500 мс.  

6. Масштабируемость  

Расширение функционала:  
Архитектура бота должна позволять добавлять новые функции (например, реферальную программу или промо-акции) без переписывания основной логики.
